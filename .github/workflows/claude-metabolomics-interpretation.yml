name: Claude Metabolomics Interpretation

on:
  push:
    paths:
      - 'results/metabolomics-analysis/**'
    branches:
      - main

jobs:
  claude-interpretation:
    if: contains(github.event.head_commit.message, 'Generated by Claude Â· Metabolomics Analysis workflow')
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
      id-token: write
      actions: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Generate Claude AI Interpretation
        uses: anthropics/claude-code-action@beta
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          direct_prompt: |
            I have committed new metabolomics analysis results to the repository. Please analyze these results and provide comprehensive scientific interpretation.
            
            The analysis files are located in the latest `results/metabolomics-analysis/` directory and include:
            - analysis_report.md (comprehensive analysis report)
            - summary_stats.csv (statistical summary)
            - pca_plot.png (PCA analysis visualization)
            - correlation_matrix.png (correlation heatmap)
            - heatmap.png (metabolite concentration heatmap)
            - README.md (analysis summary)
            
            Please read these files and provide a detailed scientific interpretation covering:
            
            ## 1. Executive Summary
            - Key findings from the metabolomics analysis
            - Overview of metabolic patterns identified
            
            ## 2. Statistical Interpretation
            - PCA results and variance explanation
            - Correlation patterns and significance
            - Data quality assessment
            
            ## 3. Biological Significance
            - Metabolic pathway implications
            - Fasting state metabolic profile insights
            - Potential biomarkers identified
            
            ## 4. Clinical Relevance
            - Health implications of findings
            - Diagnostic potential
            - Therapeutic insights
            
            ## 5. Technical Assessment
            - Data processing quality
            - Statistical validity
            - Methodological strengths/limitations
            
            ## 6. Recommendations
            - Immediate next steps
            - Future research directions
            - Additional analyses suggested
            
            Focus on the actual data patterns in the generated files. Create a new file called 
            'claude_interpretation.md' in the same results directory with your comprehensive analysis.
            
            After creating the interpretation, commit it to the repository with an appropriate commit message.