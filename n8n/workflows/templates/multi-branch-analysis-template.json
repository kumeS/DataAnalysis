{
  "name": "Claude Code Multi-Branch Analysis - Optimized",
  "nodes": [
    {
      "parameters": {},
      "id": "manual-trigger",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [100, 300]
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "input",
              "value": "{{ $json.topic || 'AIæŠ€è¡“ã¨åŒ»ç™‚å¿œç”¨' }}"
            }
          ]
        },
        "options": {}
      },
      "id": "set-input",
      "name": "Set Input Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [280, 300]
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "headerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "x-api-key",
              "value": "={{ $env.CLAUDE_API_KEY }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "claude-3-sonnet-20240229"
            },
            {
              "name": "max_tokens",
              "value": "1000"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"user\", \"content\": \"ä¸ãˆã‚‰ã‚ŒãŸãƒˆãƒ”ãƒƒã‚¯ã‹ã‚‰ã€2ã¤ã®ç•°ãªã‚‹è¦³ç‚¹ã§æ¤œç´¢ã™ã¹ãã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„: {\\\"keywordA\\\": \\\"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰1\\\", \\\"keywordB\\\": \\\"ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰2\\\", \\\"explanation\\\": \\\"èª¬æ˜\\\"}\\n\\nInput: \" + $json.input}]"
            }
          ]
        },
        "options": {}
      },
      "id": "extract-keywords",
      "name": "Extract Search Terms",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [460, 300],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "functionCode": "// Claude APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º\nconst response = items[0].json.content[0].text;\nlet keywords;\n\ntry {\n  // JSONéƒ¨åˆ†ã‚’æŠ½å‡º\n  const jsonMatch = response.match(/\\{[^}]+\\}/);\n  if (jsonMatch) {\n    keywords = JSON.parse(jsonMatch[0]);\n  } else {\n    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šç°¡å˜ãªãƒ‘ãƒ¼ã‚¹ã‚’è©¦è¡Œ\n    keywords = {\n      keywordA: \"AIæŠ€è¡“\",\n      keywordB: \"åŒ»ç™‚å¿œç”¨\",\n      explanation: \"è‡ªå‹•æŠ½å‡ºã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰\"\n    };\n  }\n} catch (error) {\n  // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\n  keywords = {\n    keywordA: \"AIæŠ€è¡“\",\n    keywordB: \"åŒ»ç™‚å¿œç”¨\",\n    explanation: \"ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤\"\n  };\n}\n\nreturn [\n  {\n    json: {\n      ...items[0].json,\n      keywordA: keywords.keywordA,\n      keywordB: keywords.keywordB,\n      explanation: keywords.explanation\n    }\n  }\n];"
      },
      "id": "parse-keywords",
      "name": "Parse Keywords",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [640, 300]
    },
    {
      "parameters": {
        "url": "https://api.serper.dev/search",
        "authentication": "headerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{ $env.SERPER_API_KEY || 'demo-key' }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $json.keywordA }}"
            },
            {
              "name": "num",
              "value": "5"
            }
          ]
        },
        "options": {}
      },
      "id": "web-search-a",
      "name": "Web Search A",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [820, 100],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "https://api.serper.dev/search",
        "authentication": "headerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-API-KEY",
              "value": "={{ $env.SERPER_API_KEY || 'demo-key' }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "={{ $json.keywordB }}"
            },
            {
              "name": "num",
              "value": "5"
            }
          ]
        },
        "options": {}
      },
      "id": "web-search-b",
      "name": "Web Search B",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [820, 500],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "headerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "x-api-key",
              "value": "={{ $env.CLAUDE_API_KEY }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "claude-3-sonnet-20240229"
            },
            {
              "name": "max_tokens",
              "value": "1500"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®æ¤œç´¢çµæœã‚’è¦ç´„ãƒ»åˆ†æã—ã¦ãã ã•ã„ã€‚è¦ç‚¹ã‚’3ã¤ã«çµã£ã¦ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚\\n\\næ¤œç´¢çµæœ: \" + JSON.stringify($json.organic || [])}]"
            }
          ]
        },
        "options": {}
      },
      "id": "summarize-a",
      "name": "Summarize A",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1020, 100],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "headerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "x-api-key",
              "value": "={{ $env.CLAUDE_API_KEY }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "claude-3-sonnet-20240229"
            },
            {
              "name": "max_tokens",
              "value": "1500"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®æ¤œç´¢çµæœã‚’è¦ç´„ãƒ»åˆ†æã—ã¦ãã ã•ã„ã€‚è¦ç‚¹ã‚’3ã¤ã«çµã£ã¦ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚\\n\\næ¤œç´¢çµæœ: \" + JSON.stringify($json.organic || [])}]"
            }
          ]
        },
        "options": {}
      },
      "id": "summarize-b",
      "name": "Summarize B",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1020, 500],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByIndex",
        "options": {}
      },
      "id": "merge-summaries",
      "name": "Merge Summaries",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [1220, 300]
    },
    {
      "parameters": {
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "headerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "x-api-key",
              "value": "={{ $env.CLAUDE_API_KEY }}"
            },
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "claude-3-sonnet-20240229"
            },
            {
              "name": "max_tokens",
              "value": "2000"
            },
            {
              "name": "messages",
              "value": "=[{\"role\": \"user\", \"content\": \"ä»¥ä¸‹ã®2ã¤ã®è¦ç´„ã‚’çµ±åˆã—ã¦ã€æœ€çµ‚çš„ãªåˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\\n\\nè¦ç´„A: \" + ($node['Summarize A'].json.content ? $node['Summarize A'].json.content[0].text : 'è¦ç´„Aå–å¾—å¤±æ•—') + \"\\n\\nè¦ç´„B: \" + ($node['Summarize B'].json.content ? $node['Summarize B'].json.content[0].text : 'è¦ç´„Bå–å¾—å¤±æ•—') + \"\\n\\nçµ±åˆãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã€çµè«–ã¨æè¨€ã‚’å«ã‚ã¦ãã ã•ã„ã€‚\"}]"
            }
          ]
        },
        "options": {}
      },
      "id": "integrate-report",
      "name": "Integrate & Report",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1420, 300],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "functionCode": "// æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã®æ•´å½¢ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\nconst report = items[0].json.content ? items[0].json.content[0].text : 'ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ';\nconst timestamp = new Date().toISOString();\n\nconst formattedReport = `# ğŸ¤– Claude Code Multi-Branch Analysis Report\n\n**å®Ÿè¡Œæ—¥æ™‚:** ${timestamp}\n**åˆ†æå¯¾è±¡:** ${$node['Set Input Data'].json.input}\n\n## ğŸ” æŠ½å‡ºã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰\n- **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰A:** ${$node['Parse Keywords'].json.keywordA}\n- **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰B:** ${$node['Parse Keywords'].json.keywordB}\n\n## ğŸ“Š çµ±åˆåˆ†æçµæœ\n\n${report}\n\n---\n*Generated by n8n Ã— Claude Code Multi-Branch Analysis Pipeline*\n*å®Ÿè¡ŒID: ${timestamp}*`;\n\nreturn [{\n  json: {\n    report: formattedReport,\n    timestamp: timestamp,\n    keywordA: $node['Parse Keywords'].json.keywordA,\n    keywordB: $node['Parse Keywords'].json.keywordB,\n    input: $node['Set Input Data'].json.input\n  }\n}];"
      },
      "id": "format-report",
      "name": "Format Final Report",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1620, 300]
    },
    {
      "parameters": {
        "channel": "#reports",
        "text": "ğŸ“‹ **Multi-Branch Analysis å®Œäº†ï¼**\\n\\nğŸ” **åˆ†æå¯¾è±¡:** {{ $json.input }}\\nğŸ“… **å®Ÿè¡Œæ™‚åˆ»:** {{ $json.timestamp }}\\nğŸ”‘ **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:** {{ $json.keywordA }} / {{ $json.keywordB }}\\n\\nè©³ç´°ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚",
        "attachments": [
          {
            "color": "good",
            "title": "åˆ†æãƒ¬ãƒãƒ¼ãƒˆ",
            "text": "{{ $json.report }}",
            "footer": "Claude Code Multi-Branch Analysis"
          }
        ]
      },
      "id": "slack-output",
      "name": "Slack Output",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1820, 300]
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Set Input Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Input Data": {
      "main": [
        [
          {
            "node": "Extract Search Terms",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Search Terms": {
      "main": [
        [
          {
            "node": "Parse Keywords",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Keywords": {
      "main": [
        [
          {
            "node": "Web Search A",
            "type": "main",
            "index": 0
          },
          {
            "node": "Web Search B",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Web Search A": {
      "main": [
        [
          {
            "node": "Summarize A",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Web Search B": {
      "main": [
        [
          {
            "node": "Summarize B",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize A": {
      "main": [
        [
          {
            "node": "Merge Summaries",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize B": {
      "main": [
        [
          {
            "node": "Merge Summaries",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Summaries": {
      "main": [
        [
          {
            "node": "Integrate & Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Integrate & Report": {
      "main": [
        [
          {
            "node": "Format Final Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Final Report": {
      "main": [
        [
          {
            "node": "Slack Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "timezone": "Asia/Tokyo",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "saveDataErrorExecution": "all"
  },
  "meta": {
    "instanceId": "claude-code-multi-branch-analysis",
    "description": "Optimized multi-branch analysis workflow with Claude integration and web search capabilities",
    "createdAt": "2025-08-04T02:01:00.000Z",
    "updatedAt": "2025-08-04T02:01:00.000Z"
  },
  "id": "multi-branch-analysis-template",
  "tags": ["claude-code", "multi-branch", "analysis", "web-search", "automation"]
}