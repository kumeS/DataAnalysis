{
  "name": "API Monitoring Workflow Template",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 5
            }
          ]
        }
      },
      "id": "monitor-trigger",
      "name": "Monitor Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "url": "={{ $json.apiEndpoint }}",
        "options": {
          "timeout": 10000
        }
      },
      "id": "health-check",
      "name": "Health Check",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "functionCode": "// APIãƒ¬ã‚¹ãƒãƒ³ã‚¹åˆ†æ\nconst response = items[0];\nconst statusCode = response.json ? 200 : 500; // Simplified\nconst responseTime = Date.now() - (response.headers?.['request-start'] || Date.now());\n\nconst healthStatus = {\n  timestamp: new Date().toISOString(),\n  endpoint: '{{ $json.apiEndpoint }}',\n  status: statusCode < 400 ? 'healthy' : 'unhealthy',\n  statusCode: statusCode,\n  responseTimeMs: responseTime,\n  isAlert: statusCode >= 400 || responseTime > 5000\n};\n\nreturn [{\n  json: healthStatus\n}];"
      },
      "id": "analyze-response",
      "name": "Analyze Response",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.isAlert }}",
              "value2": true
            }
          ]
        }
      },
      "id": "check-alert",
      "name": "Check Alert",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "channel": "#alerts",
        "text": "ğŸš¨ API ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿï¼\n\n**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:** {{ $json.endpoint }}\n**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** {{ $json.status }}\n**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰:** {{ $json.statusCode }}\n**ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“:** {{ $json.responseTimeMs }}ms\n**ç™ºç”Ÿæ™‚åˆ»:** {{ $json.timestamp }}"
      },
      "id": "send-alert",
      "name": "Send Alert",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "functionCode": "// Claude Code ã«ã‚ˆã‚‹éšœå®³åˆ†æ\nconst healthData = items[0].json;\n\nconst analysis = {\n  ...healthData,\n  claudeAnalysis: {\n    severity: healthData.statusCode >= 500 ? 'critical' : 'warning',\n    possibleCauses: [\n      healthData.statusCode >= 500 ? 'ã‚µãƒ¼ãƒãƒ¼å†…éƒ¨ã‚¨ãƒ©ãƒ¼' : 'ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼',\n      healthData.responseTimeMs > 5000 ? 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ' : 'ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ­£å¸¸',\n      'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œã®å¯èƒ½æ€§'\n    ],\n    recommendations: [\n      'ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã®ç¢ºèª',\n      'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šçŠ¶æ³ã®ç¢ºèª',\n      'CPUã¨ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ã®ç›£è¦–',\n      'ä¾å­˜ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª'\n    ],\n    autoActions: [\n      'è©³ç´°ãƒ­ã‚°ã®åé›†',\n      'é–¢é€£ãƒãƒ¼ãƒ ã¸ã®é€šçŸ¥',\n      'ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †ã®é–‹å§‹'\n    ]\n  }\n};\n\nreturn [{ json: analysis }];"
      },
      "id": "claude-incident-analysis",
      "name": "Claude Incident Analysis",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1340, 200]
    },
    {
      "parameters": {
        "functionCode": "// æ­£å¸¸çŠ¶æ…‹ã®ãƒ­ã‚°è¨˜éŒ²\nconst healthData = items[0].json;\n\nconst logEntry = {\n  ...healthData,\n  logType: 'health_check',\n  message: `APIå¥å…¨æ€§ç¢ºèªå®Œäº†: ${healthData.endpoint} - ${healthData.status}`\n};\n\nreturn [{ json: logEntry }];"
      },
      "id": "log-healthy-status",
      "name": "Log Healthy Status",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1120, 400]
    }
  ],
  "connections": {
    "Monitor Trigger": {
      "main": [
        [
          {
            "node": "Health Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Health Check": {
      "main": [
        [
          {
            "node": "Analyze Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Response": {
      "main": [
        [
          {
            "node": "Check Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Alert": {
      "main": [
        [
          {
            "node": "Send Alert",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Healthy Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Alert": {
      "main": [
        [
          {
            "node": "Claude Incident Analysis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {},
  "meta": {
    "instanceId": "claude-code-automation",
    "description": "Claude Code integrated API monitoring and incident analysis",
    "createdAt": "2025-08-04T01:43:00.000Z",
    "updatedAt": "2025-08-04T01:43:00.000Z"
  },
  "id": "api-monitoring-template",
  "tags": ["claude-code", "monitoring", "api", "alerts"]
}